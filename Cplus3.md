## 库与接口

C++中文件分为：

- 程序文件：源文件（`*`.cpp）、头文件（`*`.h  `*`.hpp  `*`）
- 库：源文件和头文件

**库**与一般程序代码是不一样的。一般程序中必须包含main函数，程序的执行依赖于main函数去控制，main函数即是程序的入口，也是程序的出口。

库从本质上来说是不会独立的运行的，所以不需要编写mian函数。库：源文件包含了具体的实现代码，头文件提供了库的**接口**。

- 数学库在windos和Linux下是不一样的，Linux下数学库是单列的。

头文件：math.h/cmath

库文件：libm

链接方式：g++  -lm main.cpp

- 工具与辅助函数

头文件：stdlib.h/cstdlib

常用函数：

```c++
void exit(int status);//推出程序执行
void free(void * p);//内存获取
void * malloc(size_t size);//内存获取
int rand();//生成随机数
void srand(unsigned int seed);//生成随机数
```

### 案例：随机数库的设计

随机数库的设计过程；

1. 随机数的生成
2. 库的设计原则
3. 随机数库接口
4. 随机数库实现
5. 随机数库测试 

```c++
//编译指令
g++ main.cpp 库文件名.cpp
```



## 作用域与生存期

1、全局数据对象具有文件（全局）作用域，有效性从定义处开始，直到本文件结束，所有的函数都可以直接使用。

2、若包含全局数据对象定义的文件被其他文件包含，则其作用域扩展到宿主文件，如果宿主文件中定义的变量名与原文件（即引用文件）全局变量名相同，则会产生冲突。

3、**函数原型作用域**：定义在函数原型中的参数具有函数原型作用域，其有效性仅延续到此函数原型结束。函数原型中参数名称可以与函数实现中的不同，也可以省略。

4、全局变量可以被覆盖，在更小的作用域中，局部变量会覆盖全局变量，使得在该小作用域中，相同变量名的变量值为局部变量的值。

**生存期**：**量在程序中存在的时间范围**。

——作用域表达量的空间特征，存储类表达量的时间特征。

- 静态（全局）生存期：全局数据对象具有（静态）生存期，生死仅与程序是否执行有关。
- 自动（局部）生存期：局部数据对象具有（局部）生存期，生死仅与程序流程是否位于该块中有关。程序每次进入该块是就为该对象分配内存，退出该块时释放内存。

**static**：修饰局部变量（静态局部变量）。使得该局部变量具有静态生存周期，程序退出该块时局部变量仍然存在，并且下次进入该块时使用上一次的数据值，static修饰的局部变量的生存周期和全局变量的生存周期一样长，静态局部变量必须进行初始化。

*static修饰的局部变量*的作用域仍是块作用域，即只能在该块中访问，对于其他代码段不可见。就是说static并没有改变局部变量的作用范围，只是延长了局部变量的生存周期。

*static修饰全局变量*使得全局变量的作用域仅限于本文件内部，其他文件不可见，即修改了全局变量的作用域，使得其不可跨文件引用。

**函数的作用域与生存期：**

1、所有函数具有文件作用域与静态生存期

在程序每次执行时都存在，并且可以在函数原型或函数定义之后的任意位置调用。函数的有效范围尽可能的大，时间尽可能的长。

2、内部函数与外部函数

- 外部函数：可以被其他文件中的函数所调用

- 内部函数：不可以被其他文件中的函数所调用

函数在缺省时均为外部函数，具有文件作用域和静态生存期，如果想要将其变为内部函数，则需要使用*static*关键字。

声明不是定义，定义在程序中产生一个新实体，声明仅仅在程序中引入一个实体。

- 函数的声明是给出函数原型，定义是给出函数实现的代码。
- 类型的声明与定义：产生新类型的就是定义，否者只能叫做声明。

 3、全局变量的定义千万不能出现在头文件中，只有声明才能出现在头文件中。

如果想要引出全局变量，使得其他源文件都可以使用该全局变量，那么需要使用*extern*关键字。在头文件中将变量导出，之后，所有包含头文件的工程文件，均可以使用该全局变量。

```c++
/*库头文件*/
extern int a;//变量a导出，其他文件可用	| 变量声明
```

```c++
/*库的源文件*/
int a;//定义变量a
```

